{% extends 'base.html' %}
{% block title %}Profilim · Pilates Studio{% endblock %}
{% block content %}
<div class="max-w-2xl mx-auto mt-8">
  <div class="rounded-2xl bg-white/80 p-6 shadow mb-8">
    <h1 class="text-2xl font-bold mb-2">Profilim</h1>
    {% if member %}
      <div class="mb-2 text-stone-700"><b>Ad Soyad:</b> {{ member.full_name }}</div>
      <div class="mb-2 text-stone-700"><b>Kalan Seans:</b> {{ member.credits }}</div>
      <div class="mb-2 text-stone-700"><b>Kayıt Tarihi:</b> {{ member.created_at.strftime('%d.%m.%Y') if member.created_at else '-' }}</div>
    {% else %}
      <div class="text-stone-500">Üye bilgisi bulunamadı.</div>
    {% endif %}
  </div>

  <div class="rounded-2xl bg-white/80 p-6 shadow">
    <h2 class="text-lg font-semibold mb-3">Ölçümlerim</h2>
    {% set items = measurements %}
    {% set is_admin = session.get('is_admin', False) %}
    {% include 'partials/_measurement_table.html' %}
  </div>

  <div class="rounded-2xl border border-white/50 bg-white/60 backdrop-blur p-4 mt-8">
    <div class="mb-2 text-sm text-stone-500">Son 4 ayda ders katılımı</div>
    <div class="overflow-x-auto">
      <div class="heatmap-grid" style="display: grid; grid-auto-flow: column; grid-template-rows: repeat(7, 1fr); gap: 3px; justify-content: center; margin-bottom: 16px;">
        {% for week in weeks|reverse %}  {# Haftaları ters sırada göster (en yeni solda) #}
          {% for day in week %}
            {% set intensity = day.count | int %}
            {% if intensity == 0 %}
              {% set bg_class = 'bg-[#f8f8f8] border border-[#e0e0e0]' %}
            {% elif intensity == 1 %}
              {% set bg_class = 'bg-[#ff69b4] opacity-50 border border-[#ff69b4]' %}
            {% elif intensity == 2 %}
              {% set bg_class = 'bg-[#ff69b4] opacity-75 border border-[#ff69b4]' %}
            {% else %}
              {% set bg_class = 'bg-[#ff69b4] border border-[#ff69b4]' %}
            {% endif %}
            <span class="heatmap-day {{ bg_class }} w-[14px] h-[14px] rounded-sm" 
                  title="{{ day.date.strftime('%d.%m.%Y') }}: {{ day.count }} katılım"></span>
          {% endfor %}
        {% endfor %}
      </div>
      <div class="heatmap-legend flex items-center justify-center gap-4 mt-2 text-xs text-stone-600">
        <div class="flex items-center gap-1">
          <span class="w-[12px] h-[12px] bg-[#f0f0f0] inline-block rounded"></span>
          <span>Katılmadı</span>
        </div>
        <div class="flex items-center gap-1">
          <span class="w-[12px] h-[12px] bg-[#ff69b4] inline-block rounded opacity-50"></span>
          <span>Az katılım</span>
        </div>
        <div class="flex items-center gap-1">
          <span class="w-[12px] h-[12px] bg-[#ff69b4] inline-block rounded"></span>
          <span>Çok katılım</span>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

