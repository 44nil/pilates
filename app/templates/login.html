{% extends "base.html" %}

{% block title %}Giriş Yap - {{ g.tenant.name if g.tenant else 'Pilates Studio' }}{% endblock %}

{% block head %}
<script
  async
  crossorigin="anonymous"
  data-clerk-publishable-key="{{ publishable_key }}"
  src="https://cdn.jsdelivr.net/npm/@clerk/clerk-js@latest/dist/clerk.browser.js"
  type="text/javascript"
></script>
{% endblock %}

{% block content %}
<div class="flex items-center justify-center min-h-[70vh]">
    
    <div class="w-full max-w-md p-8 rounded-[32px] border border-white/30 shadow-xl backdrop-blur-md bg-white/10 relative">
        
        <div class="text-center mb-6">
            <h2 class="text-3xl font-light text-stone-800 tracking-wide">
                {% if g.tenant %}
                    {{ g.tenant.name }}
                {% else %}
                    Hoş Geldiniz
                {% endif %}
            </h2>
            <div class="h-1 w-20 bg-rose-300 mx-auto mt-4 rounded-full opacity-60"></div>
        </div>

        <div id="clerk-sign-in" class="flex justify-center min-h-[300px]">
            <div class="flex items-center justify-center space-x-2 text-rose-500 animate-pulse mt-10">
                <div class="w-3 h-3 bg-rose-400 rounded-full"></div>
                <div class="w-3 h-3 bg-rose-400 rounded-full"></div>
                <div class="w-3 h-3 bg-rose-400 rounded-full"></div>
            </div>
        </div>

    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  window.addEventListener("load", async function () {
    await Clerk.load();

    if (Clerk.user) {
      // Zaten giriş yapmışsa direkt yönlendir
      const prefix = "{{ g.tenant.domain_prefix if g.tenant else '' }}";
      const redirectUrl = prefix ? `/${prefix}/auth/clerk_sync` : `/auth/clerk_sync`;
      window.location.href = redirectUrl;
    } else {
      // Giriş yapmamışsa kutuyu göster
      const signInDiv = document.getElementById("clerk-sign-in");
      
      // Yönlendirme URL'ini dinamik ayarla
      const prefix = "{{ g.tenant.domain_prefix if g.tenant else '' }}";
      const redirectUrl = prefix ? `/${prefix}/auth/clerk_sync` : `/auth/clerk_sync`;

      Clerk.mountSignIn(signInDiv, {
        afterSignInUrl: redirectUrl,
        afterSignUpUrl: redirectUrl,
        appearance: {
          elements: {
            card: "shadow-none bg-transparent", // Kartın kendi gölgesini kapat
            headerTitle: "hidden", // Başlığı gizle (biz yazdık zaten)
            headerSubtitle: "hidden",
            socialButtonsBlockButton: "bg-white/50 hover:bg-white/80 border-white/40 text-stone-700",
            formButtonPrimary: "bg-stone-800 hover:bg-stone-700 text-white",
            footerActionLink: "text-rose-600 hover:text-rose-700"
          }
        }
      });
    }
  });
</script>
{% endblock %}